# üí∞ Configura√ß√µes Fiscais - Guia Completo

## üìã Vis√£o Geral

Este documento detalha todas as configura√ß√µes fiscais necess√°rias para emiss√£o de documentos fiscais eletr√¥nicos no Brasil (NF-e, NFC-e, NFS-e).

## üèõÔ∏è C√≥digos IBGE

### Estados (UF)

| UF | C√≥digo | Estado |
|----|--------|--------|
| AC | 12 | Acre |
| AL | 27 | Alagoas |
| AP | 16 | Amap√° |
| AM | 13 | Amazonas |
| BA | 29 | Bahia |
| CE | 23 | Cear√° |
| DF | 53 | Distrito Federal |
| ES | 32 | Esp√≠rito Santo |
| GO | 52 | Goi√°s |
| MA | 21 | Maranh√£o |
| MT | 51 | Mato Grosso |
| MS | 50 | Mato Grosso do Sul |
| MG | 31 | Minas Gerais |
| PA | 15 | Par√° |
| PB | 25 | Para√≠ba |
| PR | 41 | Paran√° |
| PE | 26 | Pernambuco |
| PI | 22 | Piau√≠ |
| RJ | 33 | Rio de Janeiro |
| RN | 24 | Rio Grande do Norte |
| RS | 43 | Rio Grande do Sul |
| RO | 11 | Rond√¥nia |
| RR | 14 | Roraima |
| SC | 42 | Santa Catarina |
| SP | 35 | S√£o Paulo |
| SE | 28 | Sergipe |
| TO | 17 | Tocantins |

### Munic√≠pios Principais (SP)

| Munic√≠pio | C√≥digo IBGE |
|-----------|-------------|
| S√£o Paulo | 3550308 |
| Campinas | 3509502 |
| Santos | 3548500 |
| S√£o Bernardo do Campo | 3548708 |
| Guarulhos | 3518800 |
| Osasco | 3534401 |
| Ribeir√£o Preto | 3543402 |
| Sorocaba | 3552205 |

**Consulta completa:** [IBGE - C√≥digos de Munic√≠pios](https://www.ibge.gov.br/explica/codigos-dos-municipios.php)

## üìä Tipos de Contribuinte

### Contribuinte ICMS
- Empresas que comercializam produtos
- Obrigadas a recolher ICMS
- Emitem NF-e e NFC-e

### Contribuinte ISS
- Empresas prestadoras de servi√ßos
- Obrigadas a recolher ISS
- Emitem NFS-e

### N√£o Contribuinte
- N√£o recolhem ICMS nem ISS
- Geralmente MEIs ou profissionais liberais

### Isento
- Isentos de tributos espec√≠ficos
- Podem ser isentos de ICMS ou ISS conforme legisla√ß√£o

## üíº Regimes de Apura√ß√£o

### Simples Nacional
- Para empresas com faturamento at√© R$ 4,8 milh√µes/ano
- Tributa√ß√£o simplificada e unificada
- Al√≠quotas progressivas por faixa de faturamento
- **CFOP comum:** 5102, 6102

### Lucro Presumido
- Para empresas com faturamento at√© R$ 78 milh√µes/ano
- Base de c√°lculo presumida sobre o faturamento
- Al√≠quotas espec√≠ficas por atividade
- **CFOP comum:** 5102, 6102, 5405

### Lucro Real
- Obrigat√≥rio para grandes empresas
- Tributa√ß√£o sobre o lucro l√≠quido cont√°bil
- Exige contabilidade completa
- **CFOP comum:** 5102, 6102, 5405, 5403

### MEI (Microempreendedor Individual)
- Faturamento at√© R$ 81 mil/ano
- Tributa√ß√£o fixa mensal
- Dispensa de emiss√£o de nota para consumidor final
- **CFOP comum:** 5102

## üî¢ CFOPs Mais Utilizados

### Opera√ß√µes Internas (Dentro do Estado)

| CFOP | Descri√ß√£o |
|------|-----------|
| 5101 | Venda de produ√ß√£o do estabelecimento |
| 5102 | Venda de mercadoria adquirida ou recebida de terceiros |
| 5103 | Venda de produ√ß√£o do estabelecimento efetuada fora do estabelecimento |
| 5104 | Venda de mercadoria adquirida ou recebida de terceiros, efetuada fora do estabelecimento |
| 5405 | Venda de mercadoria adquirida ou recebida de terceiros em opera√ß√£o com mercadoria sujeita ao regime de substitui√ß√£o tribut√°ria, na condi√ß√£o de contribuinte substituto |
| 5403 | Venda de mercadoria adquirida ou recebida de terceiros em opera√ß√£o com mercadoria sujeita ao regime de substitui√ß√£o tribut√°ria, na condi√ß√£o de contribuinte substitu√≠do |

### Opera√ß√µes Interestaduais (Entre Estados)

| CFOP | Descri√ß√£o |
|------|-----------|
| 6101 | Venda de produ√ß√£o do estabelecimento |
| 6102 | Venda de mercadoria adquirida ou recebida de terceiros |
| 6103 | Venda de produ√ß√£o do estabelecimento efetuada fora do estabelecimento |
| 6104 | Venda de mercadoria adquirida ou recebida de terceiros, efetuada fora do estabelecimento |
| 6405 | Venda de mercadoria adquirida ou recebida de terceiros em opera√ß√£o com mercadoria sujeita ao regime de substitui√ß√£o tribut√°ria, na condi√ß√£o de contribuinte substituto |

### Devolu√ß√£o e Retorno

| CFOP | Descri√ß√£o |
|------|-----------|
| 5201 | Devolu√ß√£o de compra para industrializa√ß√£o ou produ√ß√£o rural (opera√ß√£o interna) |
| 5202 | Devolu√ß√£o de compra para comercializa√ß√£o (opera√ß√£o interna) |
| 6201 | Devolu√ß√£o de compra para industrializa√ß√£o ou produ√ß√£o rural (opera√ß√£o interestadual) |
| 6202 | Devolu√ß√£o de compra para comercializa√ß√£o (opera√ß√£o interestadual) |

## üìÑ Tipos de Notas Fiscais

### NF-e (Nota Fiscal Eletr√¥nica)
- **Uso:** Venda de produtos
- **Ambiente:** SEFAZ estadual
- **S√©rie:** Num√©rica (ex: "1", "2")
- **Numera√ß√£o:** Sequencial por s√©rie
- **Certificado:** A1 ou A3 obrigat√≥rio
- **Validade:** Ap√≥s autoriza√ß√£o pela SEFAZ

### NFC-e (Nota Fiscal de Consumidor Eletr√¥nica)
- **Uso:** Venda direta ao consumidor (substitui cupom fiscal)
- **Ambiente:** SEFAZ estadual
- **S√©rie:** Num√©rica (ex: "1")
- **Numera√ß√£o:** Sequencial por s√©rie
- **Certificado:** A1 ou A3 obrigat√≥rio
- **Limite:** Geralmente at√© R$ 100 mil por nota

### NFS-e (Nota Fiscal de Servi√ßos Eletr√¥nica)
- **Uso:** Presta√ß√£o de servi√ßos
- **Ambiente:** Prefeitura municipal
- **S√©rie:** Conforme prefeitura
- **Numera√ß√£o:** Sequencial por s√©rie
- **Certificado:** Depende da prefeitura (algumas dispensam)

## üîê Certificado Digital

### Tipos de Certificado

#### A1
- **Formato:** Arquivo .pfx ou .p12
- **Armazenamento:** No computador/servidor
- **Validade:** 1 ano
- **Vantagens:** Mais barato, f√°cil de usar
- **Desvantagens:** Menos seguro, precisa renovar anualmente

#### A3
- **Formato:** Cart√£o ou token USB
- **Armazenamento:** Hardware espec√≠fico
- **Validade:** 1 a 5 anos
- **Vantagens:** Mais seguro
- **Desvantagens:** Mais caro, requer hardware

### Obten√ß√£o do Certificado

1. **Escolher uma Autoridade Certificadora (AC)**
   - Serasa Experian
   - Certisign
   - Soluti (antiga Valid)
   - AR Soluti

2. **Tipo de Pessoa**
   - e-CNPJ (para empresas)
   - e-CPF (para pessoas f√≠sicas)

3. **Processo**
   - Compra online
   - Valida√ß√£o presencial ou videoconfer√™ncia
   - Emiss√£o do certificado

4. **Custos**
   - A1: R$ 150 a R$ 300
   - A3: R$ 200 a R$ 500

## üåê Ambientes Fiscais

### Homologa√ß√£o
- **Uso:** Testes e valida√ß√µes
- **Notas:** Sem validade jur√≠dica
- **Acesso:** Liberado para testes
- **Importante:** Usar sempre antes de produ√ß√£o

### Produ√ß√£o
- **Uso:** Opera√ß√£o real
- **Notas:** Com validade jur√≠dica
- **Acesso:** Ap√≥s testes em homologa√ß√£o
- **Importante:** Erros geram custos e retrabalho

## üìä Numera√ß√£o de Notas

### Regras Gerais
- Numera√ß√£o sequencial obrigat√≥ria
- N√£o pode haver n√∫meros duplicados na mesma s√©rie
- N√£o pode haver saltos de numera√ß√£o
- Inutiliza√ß√£o de n√∫meros requer autoriza√ß√£o da SEFAZ

### S√©ries
- Empresas podem ter m√∫ltiplas s√©ries
- S√©rie "1" √© a mais comum
- Uso de s√©ries diferentes para:
  - Filiais diferentes
  - Tipos de opera√ß√£o diferentes
  - Separa√ß√£o por departamento

### Controle de Numera√ß√£o
```typescript
// Exemplo de incremento seguro de numera√ß√£o
async function getNextNumber(companyId: string, tipoNota: 'NFe' | 'NFCe' | 'NFSe') {
  const company = await prisma.company.findUnique({
    where: { id: companyId }
  });
  
  let nextNumber: number;
  let field: string;
  
  switch(tipoNota) {
    case 'NFe':
      nextNumber = company.ultimoNumeroNFe + 1;
      field = 'ultimoNumeroNFe';
      break;
    case 'NFCe':
      nextNumber = company.ultimoNumeroNFCe + 1;
      field = 'ultimoNumeroNFCe';
      break;
    case 'NFSe':
      nextNumber = company.ultimoNumeroNFSe + 1;
      field = 'ultimoNumeroNFSe';
      break;
  }
  
  // Atualizar atomicamente para evitar race conditions
  await prisma.company.update({
    where: { id: companyId },
    data: { [field]: nextNumber }
  });
  
  return nextNumber;
}
```

## üîß Configura√ß√£o Inicial Recomendada

### Passo a Passo

1. **Cadastrar Empresa com Dados B√°sicos**
   - Raz√£o Social, CNPJ, IE
   - Endere√ßo completo
   - Contatos

2. **Configurar Regime Tribut√°rio**
   - Tipo de contribuinte
   - Regime de apura√ß√£o
   - CFOP padr√£o

3. **Obter C√≥digos IBGE**
   - Munic√≠pio
   - Estado

4. **Adquirir Certificado Digital**
   - Escolher A1 ou A3
   - Contratar com AC
   - Armazenar com seguran√ßa

5. **Configurar S√©ries e Numera√ß√£o**
   - Definir s√©ries (geralmente "1")
   - Iniciar numera√ß√£o em 1

6. **Testar em Homologa√ß√£o**
   - Configurar ambiente como "Homologacao"
   - Emitir notas de teste
   - Validar todas as opera√ß√µes

7. **Migrar para Produ√ß√£o**
   - Alterar ambiente para "Producao"
   - Emitir primeira nota real
   - Monitorar resultados

## üìö Refer√™ncias e Links √öteis

- [Portal NF-e](http://www.nfe.fazenda.gov.br/)
- [Manual de Integra√ß√£o NF-e](http://www.nfe.fazenda.gov.br/portal/listaConteudo.aspx?tipoConteudo=/fNJvKGW+oA=)
- [Tabela CFOP Completa](http://www.nfe.fazenda.gov.br/portal/listaConteudo.aspx?tipoConteudo=Iy/5Qol1YbE=)
- [IBGE C√≥digos de Munic√≠pios](https://www.ibge.gov.br/explica/codigos-dos-municipios.php)
- [Portal do Simples Nacional](http://www8.receita.fazenda.gov.br/simplesnacional/)

---

**Nota:** As informa√ß√µes fiscais est√£o sujeitas a mudan√ßas conforme legisla√ß√£o. Sempre consulte um contador para orienta√ß√µes espec√≠ficas.
