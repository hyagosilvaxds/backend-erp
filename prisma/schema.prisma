// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Modelo de Usuário
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  photoUrl  String?  // URL da foto do usuário
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamento com empresas
  companies UserCompany[]
  
  // Auditoria
  companyAudits CompanyAudit[]
  
  // Documentos
  foldersCreated DocumentFolder[] @relation("FolderCreatedBy")
  documentsUploaded Document[] @relation("DocumentUploadedBy")
  
  // RH
  employeesCreated Employee[] @relation("EmployeeCreatedBy")
  payrollsCreated Payroll[] @relation("PayrollCreatedBy")
  payrollsApproved Payroll[] @relation("PayrollApprovedBy")
  employeeDocumentsUploaded EmployeeDocument[] @relation("DocumentUploadedByUser")

  @@map("users")
}

// Modelo de Empresa
model Company {
  id String @id @default(uuid())

  // Informações cadastrais básicas
  razaoSocial       String // Nome jurídico da empresa
  nomeFantasia      String? // Nome comercial usado no dia a dia
  cnpj              String  @unique // Cadastro Nacional de Pessoa Jurídica
  inscricaoEstadual String? // Cadastro na SEFAZ
  inscricaoMunicipal String? // Para emissão de NFS-e
  
  // Regime tributário e atividades
  regimeTributario  String? // Simples Nacional, Lucro Presumido, Lucro Real
  cnaePrincipal     String? // Código CNAE da atividade principal
  cnaeSecundarios   String[] // Lista de códigos CNAE secundários
  
  // Datas e situação
  dataAbertura      DateTime? // Data de fundação da empresa
  situacaoCadastral String    @default("Ativa") // Ativa / Inativa / Suspensa
  
  // Endereço
  logradouro   String? // Rua, Avenida, etc.
  numero       String? // Número do endereço
  complemento  String? // Apto, sala, bloco, etc.
  bairro       String? // Bairro
  cidade       String? // Município
  estado       String? // UF (sigla do estado)
  cep          String? // CEP
  pais         String  @default("Brasil") // País
  
  // Contatos
  telefone     String? // Telefone fixo
  celular      String? // Celular / WhatsApp
  email        String? // E-mail principal
  site         String? // Site (opcional)
  
  // Configurações fiscais e tributárias
  tipoContribuinte       String? // ICMS, ISS, Isento, etc.
  regimeApuracao         String? // Simples Nacional, Lucro Presumido, Lucro Real
  codigoMunicipioIBGE    String? // Código IBGE do município
  codigoEstadoIBGE       String? // Código IBGE do estado
  cfopPadrao             String? // CFOP padrão para operações
  
  // Certificado digital para emissão de notas fiscais
  certificadoDigitalPath String? // Caminho do arquivo do certificado A1
  certificadoDigitalSenha String? // Senha do certificado (criptografada)
  
  // Numeração de notas fiscais
  serieNFe               String? // Série da NF-e
  ultimoNumeroNFe        Int?    @default(0) // Último número de NF-e emitido
  serieNFCe              String? // Série da NFC-e
  ultimoNumeroNFCe       Int?    @default(0) // Último número de NFC-e emitido
  serieNFSe              String? // Série da NFS-e
  ultimoNumeroNFSe       Int?    @default(0) // Último número de NFS-e emitido
  
  // Ambiente fiscal
  ambienteFiscal         String  @default("Homologacao") // Homologacao ou Producao
  
  // Logo e identidade visual
  logoUrl                String? // URL ou caminho do arquivo de logo
  logoFileName           String? // Nome do arquivo original
  logoMimeType           String? // Tipo MIME (image/png, image/jpeg, etc.)
  
  // Plano de contas
  planoContasId          String? // ID do plano de contas padrão utilizado
  
  // Controle interno
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamento com usuários
  users UserCompany[]
  
  // Auditoria
  audits CompanyAudit[]
  
  // Centros de custo
  centrosCusto CentroCusto[]
  
  // Planos de contas
  planosContas PlanoContas[]
  
  // Documentos
  documentFolders DocumentFolder[]
  documents Document[]
  
  // Produtos
  productCategories ProductCategory[]
  productUnits ProductUnit[]
  productBrands ProductBrand[]
  products Product[]
  productStockMovements ProductStockMovement[]
  stockLocations StockLocation[]
  productStocksByLocation ProductStockByLocation[]
  stockTransfers StockTransfer[]
  
  // Clientes
  customers Customer[]
  
  // RH
  employees Employee[]
  positions Position[]
  departments Department[]
  earningTypes EarningType[]
  deductionTypes DeductionType[]
  payrolls Payroll[]
  
  // Tabelas fiscais
  inssTables InssTable[]
  fgtsTables FgtsTable[]
  irrfTables IrrfTable[]

  @@map("companies")
}

// Modelo de Plano de Contas
model PlanoContas {
  id          String   @id @default(uuid())
  
  // Empresa dona do plano de contas
  companyId   String?  // Null para planos padrão do sistema
  company     Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  nome        String // Ex: "Plano de Contas Padrão", "Plano Comercial", "Plano Industrial"
  descricao   String?
  tipo        String   @default("Gerencial") // Gerencial, Fiscal, Contabil
  ativo       Boolean  @default(true)
  padrao      Boolean  @default(false) // Se é o plano de contas padrão do sistema
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relacionamento com contas
  contas ContaContabil[]

  @@index([companyId])
  @@map("plano_contas")
}

// Modelo de Conta Contábil
model ContaContabil {
  id              String   @id @default(uuid())
  planoContasId   String
  codigo          String // Ex: "1.1.01.001"
  nome            String // Ex: "Caixa Geral"
  tipo            String // Ativo, Passivo, Receita, Despesa, Patrimônio Líquido
  natureza        String // Devedora, Credora
  nivel           Int // Nível hierárquico da conta (1, 2, 3, 4...)
  contaPaiId      String? // Conta pai na hierarquia
  aceitaLancamento Boolean @default(true) // Se aceita lançamentos diretos
  ativo           Boolean @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relacionamentos
  planoContas PlanoContas @relation(fields: [planoContasId], references: [id], onDelete: Cascade)
  contaPai    ContaContabil? @relation("ContaHierarquia", fields: [contaPaiId], references: [id])
  subContas   ContaContabil[] @relation("ContaHierarquia")

  @@unique([planoContasId, codigo])
  @@map("contas_contabeis")
}

// Tabela pivô entre Usuário e Empresa com Role
model UserCompany {
  id        String   @id @default(uuid())
  userId    String
  companyId String
  roleId    String
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  role    Role    @relation(fields: [roleId], references: [id])

  @@unique([userId, companyId])
  @@map("user_companies")
}

// Modelo de Role (Papel/Função)
model Role {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relacionamentos
  userCompanies  UserCompany[]
  rolePermissions RolePermission[]

  @@map("roles")
}

// Modelo de Permissão
model Permission {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  resource    String // Ex: "users", "products", "sales"
  action      String // Ex: "create", "read", "update", "delete"
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relacionamentos
  rolePermissions RolePermission[]

  @@unique([resource, action])
  @@map("permissions")
}

// Tabela pivô entre Role e Permission
model RolePermission {
  id           String   @id @default(uuid())
  roleId       String
  permissionId String
  createdAt    DateTime @default(now())

  // Relacionamentos
  role       Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@map("role_permissions")
}

// Modelo de Auditoria de Empresas
model CompanyAudit {
  id        String   @id @default(uuid())
  
  // Empresa auditada
  companyId String
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  // Usuário que fez a alteração
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  
  // Tipo de ação
  action    String   // CREATE, UPDATE, DELETE, UPLOAD_LOGO, REMOVE_LOGO, UPLOAD_CERTIFICATE, REMOVE_CERTIFICATE, TOGGLE_ACTIVE
  
  // Dados da alteração
  entityType String  @default("Company") // Tipo da entidade
  fieldName  String? // Campo específico alterado (opcional)
  oldValue   String? // Valor anterior (JSON string)
  newValue   String? // Novo valor (JSON string)
  
  // Metadados
  ipAddress  String? // IP do usuário
  userAgent  String? // Browser/app do usuário
  description String? // Descrição legível da ação
  
  // Timestamp
  createdAt DateTime @default(now())
  
  @@index([companyId])
  @@index([userId])
  @@index([action])
  @@index([createdAt])
  @@map("company_audits")
}

// Modelo de Centro de Custos
model CentroCusto {
  id          String   @id @default(uuid())
  
  // Empresa dona do centro de custo
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  // Hierarquia
  codigo      String   // Ex: 01, 01.01, 01.01.001
  nome        String   // Ex: Administrativo, Vendas, Marketing
  descricao   String?  // Descrição detalhada
  
  // Estrutura hierárquica
  centroCustoPaiId String? // Centro de custo pai
  centroCustoPai   CentroCusto?  @relation("CentroCustoHierarchy", fields: [centroCustoPaiId], references: [id], onDelete: Restrict)
  subCentros       CentroCusto[] @relation("CentroCustoHierarchy")
  
  nivel       Int      // Nível na hierarquia (1, 2, 3, ...)
  
  // Responsável
  responsavel String?  // Nome do responsável pelo centro de custo
  email       String?  // Email do responsável
  
  // Status
  ativo       Boolean  @default(true)
  
  // Relacionamentos
  employees   Employee[] // Colaboradores vinculados
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([companyId, codigo])
  @@index([companyId])
  @@index([centroCustoPaiId])
  @@index([codigo])
  @@map("centros_custo")
}

// ==================== SISTEMA DE DOCUMENTOS ====================

// Pastas de documentos
model DocumentFolder {
  id          String   @id @default(uuid())
  
  // Empresa e organização
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  // Dados da pasta
  name        String   // Nome da pasta
  description String?  // Descrição opcional
  color       String?  // Cor para identificação visual (hex code)
  icon        String?  // Ícone opcional
  
  // Hierarquia de pastas
  parentId    String?
  parent      DocumentFolder?  @relation("FolderHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  subfolders  DocumentFolder[] @relation("FolderHierarchy")
  
  // Documentos
  documents   Document[]
  
  // Controle de acesso
  isPublic    Boolean  @default(false) // Se true, todos da empresa podem ver
  allowedRoleIds String[] @default([]) // IDs das roles que podem visualizar (vazio = todas)
  
  // Auditoria
  createdById String
  createdBy   User     @relation("FolderCreatedBy", fields: [createdById], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([companyId])
  @@index([parentId])
  @@index([createdById])
  @@map("document_folders")
}

// Documentos
model Document {
  id            String   @id @default(uuid())
  
  // Empresa e organização
  companyId     String
  company       Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  folderId      String?
  folder        DocumentFolder? @relation(fields: [folderId], references: [id], onDelete: SetNull)
  
  // Dados do documento
  name          String   // Nome do arquivo
  description   String?  // Descrição do documento
  
  // Arquivo
  fileName      String   // Nome original do arquivo
  filePath      String   // Caminho no servidor
  fileSize      Int      // Tamanho em bytes
  mimeType      String   // Tipo MIME (application/pdf, image/jpeg, etc.)
  fileExtension String   // Extensão (.pdf, .jpg, .docx, etc.)
  
  // Metadados
  reference     String?  // Referência/código do documento
  documentType  String?  // Tipo: "contrato", "nota_fiscal", "comprovante", "certificado", etc.
  tags          String[] // Tags para busca e organização
  
  // Validade
  expiresAt     DateTime? // Data de validade/vencimento
  isExpired     Boolean   @default(false) // Se o documento está vencido
  
  // Controle de versão
  version       Int      @default(1) // Versão do documento
  previousVersionId String? // ID da versão anterior
  previousVersion   Document? @relation("DocumentVersions", fields: [previousVersionId], references: [id], onDelete: SetNull)
  nextVersions      Document[] @relation("DocumentVersions")
  isLatest      Boolean  @default(true) // Se é a versão mais recente
  
  // Controle de acesso
  isPublic      Boolean  @default(false) // Se true, todos da empresa podem ver
  allowedRoleIds String[] @default([]) // IDs das roles que podem visualizar (vazio = todas)
  
  // Auditoria
  uploadedById  String
  uploadedBy    User     @relation("DocumentUploadedBy", fields: [uploadedById], references: [id])
  
  // Relacionamentos com produtos
  productPhotos ProductPhoto[]
  stockMovements ProductStockMovement[]
  stockTransfers StockTransfer[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([companyId])
  @@index([folderId])
  @@index([uploadedById])
  @@index([reference])
  @@index([documentType])
  @@index([expiresAt])
  @@index([isExpired])
  @@index([previousVersionId])
  @@map("documents")
}

// Modelo de Categoria de Produtos
model ProductCategory {
  id          String   @id @default(uuid())
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  name        String   // Nome da categoria
  description String?  // Descrição
  parentId    String?  // Para subcategorias
  parent      ProductCategory?  @relation("CategorySubcategories", fields: [parentId], references: [id], onDelete: Restrict)
  subcategories ProductCategory[] @relation("CategorySubcategories")
  
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Produtos
  products    Product[]
  
  @@unique([companyId, name, parentId])
  @@index([companyId])
  @@index([parentId])
  @@map("product_categories")
}

// Modelo de Unidade de Medida
model ProductUnit {
  id          String   @id @default(uuid())
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  name         String   // Nome da unidade (ex: Unidade, Caixa, Kg, Litro)
  abbreviation String   // Abreviação (ex: UN, CX, KG, L)
  fractionable Boolean  @default(false) // Permite quantidades fracionadas (0.5 KG)
  
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Produtos
  products    Product[]
  
  @@unique([companyId, abbreviation])
  @@index([companyId])
  @@map("product_units")
}

// Modelo de Marca
model ProductBrand {
  id          String   @id @default(uuid())
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  name        String   // Nome da marca
  description String?  // Descrição
  
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Produtos
  products    Product[]
  
  @@unique([companyId, name])
  @@index([companyId])
  @@map("product_brands")
}

// Modelo de Produto
model Product {
  id          String   @id @default(uuid())
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  // Informações básicas
  name        String   // Nome do produto
  description String?  // Descrição detalhada
  sku         String?  // Código SKU interno
  barcode     String?  // Código de barras (EAN/GTIN)
  reference   String?  // Referência (código do fornecedor)
  
  // Categoria e classificação
  categoryId  String?
  category    ProductCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  brandId     String?
  brand       ProductBrand?    @relation(fields: [brandId], references: [id], onDelete: SetNull)
  
  // Preços e valores
  costPrice        Decimal  @default(0) @db.Decimal(10, 2)  // Preço de custo
  profitMargin     Decimal  @default(0) @db.Decimal(5, 2)   // % de lucro
  salePrice        Decimal  @default(0) @db.Decimal(10, 2)  // Preço de venda padrão
  salePriceCash    Decimal? @db.Decimal(10, 2)              // Preço à vista
  salePriceInstallment Decimal @default(0) @db.Decimal(10, 2) // Preço de venda a prazo
  minPrice         Decimal? @db.Decimal(10, 2)              // Preço mínimo (alias)
  minSalePrice     Decimal  @default(0) @db.Decimal(10, 2)  // Valor mínimo de venda
  wholesalePrice   Decimal? @db.Decimal(10, 2)              // Valor de atacado
  minWholesaleQty  Int?                                     // Quantidade mínima para atacado
  
  // Estoque
  manageStock      Boolean  @default(true)  // Gerenciar estoque
  currentStock     Decimal  @default(0) @db.Decimal(10, 3)  // Estoque atual
  initialStock     Decimal  @default(0) @db.Decimal(10, 3)  // Estoque inicial
  minStock         Decimal  @default(0) @db.Decimal(10, 3)  // Estoque mínimo
  maxStock         Decimal? @db.Decimal(10, 3)              // Estoque máximo
  
  // Unidade
  unitId       String?
  unit         ProductUnit? @relation(fields: [unitId], references: [id], onDelete: SetNull)
  
  // Dimensões e peso
  dimensionType String?  // UNITS, CM, M, IN, FT
  width        Decimal? @db.Decimal(10, 2)  // Largura
  height       Decimal? @db.Decimal(10, 2)  // Altura
  length       Decimal? @db.Decimal(10, 2)  // Comprimento
  weight       Decimal? @db.Decimal(10, 3)  // Peso líquido
  grossWeight  Decimal? @db.Decimal(10, 3)  // Peso bruto
  
  // Validade e garantia
  expiryAlertDays Int?     // Alerta de validade (dias antes)
  warrantyPeriod  Int?     // Prazo de garantia (dias)
  
  // Tipo de produto
  productType  String   @default("SIMPLE") // SIMPLE, COMPOSITE, VARIABLE, COMBO
  isComposite  Boolean  @default(false)    // Se é composto por outros produtos
  hasVariations Boolean @default(false)    // Se tem variações (tamanho, cor, etc)
  isCombo      Boolean  @default(false)    // Se é um combo/kit
  
  // Status e disponibilidade
  active       Boolean  @default(true)
  availability String   @default("AVAILABLE") // AVAILABLE, OUT_OF_STOCK, PRE_ORDER, DISCONTINUED
  
  // Observações
  notes        String?  @db.Text
  
  // Informações fiscais (NCM, CEST, CFOP, etc serão adicionados)
  ncm          String?  // Nomenclatura Comum do Mercosul
  cest         String?  // Código Especificador da Substituição Tributária
  origin       String?  // Origem da mercadoria (0-8)
  
  // ICMS
  icmsCst      String?  // Código de Situação Tributária do ICMS
  icmsRate     Decimal? @db.Decimal(5, 2)  // Alíquota do ICMS
  icmsModBc    String?  // Modalidade de determinação da BC do ICMS
  
  // IPI
  ipiCst       String?  // CST do IPI
  ipiRate      Decimal? @db.Decimal(5, 2)  // Alíquota do IPI
  
  // PIS
  pisCst       String?  // CST do PIS
  pisRate      Decimal? @db.Decimal(5, 2)  // Alíquota do PIS
  
  // COFINS
  cofinsCst    String?  // CST do COFINS
  cofinsRate   Decimal? @db.Decimal(5, 2)  // Alíquota do COFINS
  
  // CFOP - Código Fiscal de Operações e Prestações
  cfopEstadual             String?  // CFOP para vendas dentro do estado (ex: 5102)
  cfopInterestadual        String?  // CFOP para vendas fora do estado (ex: 6102)
  cfopEntradaEstadual      String?  // CFOP para compras dentro do estado (ex: 1102)
  cfopEntradaInterestadual String?  // CFOP para compras fora do estado (ex: 2102)
  
  // Tipo do Item SPED (00-99)
  tipoItemSped  String?  // Tipo do item para escrituração fiscal (EFD ICMS/IPI)
  
  // Tipo do Produto (PRODUTO ou SERVICO)
  tipoProduto   String?  @default("PRODUTO")  // Define se é produto físico ou serviço
  
  // ISS - Imposto Sobre Serviços (usado quando tipoProduto = 'SERVICO')
  codigoServico     String?  // Código do serviço municipal
  issRate           Decimal? @db.Decimal(5, 2)  // Alíquota do ISS
  itemListaServico  String?  // Item da lista de serviços LC 116/2003
  
  // Auditoria
  createdById  String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Relações
  photos       ProductPhoto[]
  variations   ProductVariation[]
  compositeItems ProductComposite[] @relation("CompositeProduct")
  composedIn   ProductComposite[] @relation("ComponentProduct")
  comboItems   ProductCombo[]     @relation("ComboProduct")
  itemsInCombo ProductCombo[]     @relation("ComboItem")
  stockMovements ProductStockMovement[]
  stocksByLocation ProductStockByLocation[]
  transferItems StockTransferItem[]
  
  @@unique([companyId, barcode])
  @@unique([companyId, sku])
  @@index([companyId])
  @@index([categoryId])
  @@index([brandId])
  @@index([unitId])
  @@index([barcode])
  @@index([sku])
  @@index([active])
  @@index([productType])
  @@map("products")
}

// Modelo de Fotos de Produto
model ProductPhoto {
  id         String   @id @default(uuid())
  productId  String
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  documentId String   // Referência ao documento no hub
  document   Document @relation(fields: [documentId], references: [id], onDelete: Restrict)
  isPrimary  Boolean  @default(false)  // Se é a foto principal
  order      Int      @default(0)      // Ordem de exibição
  
  createdAt  DateTime @default(now())
  
  @@index([productId])
  @@index([documentId])
  @@map("product_photos")
}

// Modelo de Variações de Produto (ex: tamanho, cor)
model ProductVariation {
  id          String   @id @default(uuid())
  productId   String
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  name        String   // Nome da variação (ex: Tamanho P - Azul)
  sku         String?  // SKU específico da variação
  barcode     String?  // Código de barras específico
  
  // Preços específicos (opcional, se diferente do produto pai)
  costPrice        Decimal? @db.Decimal(10, 2)
  salePrice        Decimal? @db.Decimal(10, 2)
  salePriceInstallment Decimal? @db.Decimal(10, 2)
  
  // Estoque específico
  currentStock Decimal  @default(0) @db.Decimal(10, 3)
  
  // Atributos da variação
  attributes   Json     // { "size": "P", "color": "Azul" }
  
  active       Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@unique([productId, sku])
  @@index([productId])
  @@index([barcode])
  @@map("product_variations")
}

// Modelo de Produto Composto (receita)
model ProductComposite {
  id            String   @id @default(uuid())
  compositeId   String   // Produto composto (final)
  composite     Product  @relation("CompositeProduct", fields: [compositeId], references: [id], onDelete: Cascade)
  componentId   String   // Produto componente (ingrediente)
  component     Product  @relation("ComponentProduct", fields: [componentId], references: [id], onDelete: Cascade)
  
  quantity      Decimal  @db.Decimal(10, 3)  // Quantidade necessária
  
  createdAt     DateTime @default(now())
  
  @@unique([compositeId, componentId])
  @@index([compositeId])
  @@index([componentId])
  @@map("product_composites")
}

// Modelo de Combo (kit de produtos)
model ProductCombo {
  id        String   @id @default(uuid())
  comboId   String   // Produto combo
  combo     Product  @relation("ComboProduct", fields: [comboId], references: [id], onDelete: Cascade)
  itemId    String   // Produto do combo
  item      Product  @relation("ComboItem", fields: [itemId], references: [id], onDelete: Cascade)
  
  quantity  Decimal  @db.Decimal(10, 3)  // Quantidade no combo
  
  createdAt DateTime @default(now())
  
  @@unique([comboId, itemId])
  @@index([comboId])
  @@index([itemId])
  @@map("product_combos")
}

// Modelo de Movimentação de Estoque
model ProductStockMovement {
  id          String   @id @default(uuid())
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  productId   String
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  type        String   // ENTRY, EXIT, ADJUSTMENT, RETURN, LOSS, TRANSFER
  quantity    Decimal  @db.Decimal(10, 3)  // Quantidade (positivo ou negativo)
  previousStock Decimal @db.Decimal(10, 3) // Estoque anterior
  newStock    Decimal  @db.Decimal(10, 3)  // Novo estoque
  
  reason      String?  // Motivo da movimentação
  notes       String?  // Observações
  reference   String?  // Referência (ex: número da NF)
  
  // Relacionamento com local de estoque
  locationId  String?
  location    StockLocation? @relation(fields: [locationId], references: [id], onDelete: SetNull)
  
  // Para transferências entre locais
  transferId  String?
  transfer    StockTransfer? @relation(fields: [transferId], references: [id], onDelete: SetNull)
  
  // Documento vinculado (nota fiscal, recibo, etc)
  documentId  String?
  document    Document? @relation(fields: [documentId], references: [id], onDelete: SetNull)
  
  userId      String?  // Usuário que fez a movimentação
  createdAt   DateTime @default(now())
  
  @@index([companyId])
  @@index([productId])
  @@index([locationId])
  @@index([transferId])
  @@index([type])
  @@index([createdAt])
  @@map("product_stock_movements")
}

// Local de Estoque (Depósito, Loja, etc)
model StockLocation {
  id          String   @id @default(uuid())
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  name        String   // Nome do local (ex: "Depósito Central", "Loja Shopping")
  code        String   // Código único do local (ex: "DEP-01", "LOJA-01")
  description String?  // Descrição do local
  address     String?  // Endereço do local
  isDefault   Boolean  @default(false) // Local padrão para novas movimentações
  active      Boolean  @default(true)
  
  // Relacionamentos
  productStocks ProductStockByLocation[] // Estoque de produtos neste local
  stockMovements ProductStockMovement[] // Movimentações neste local
  transfersFrom StockTransfer[] @relation("TransferFrom") // Transferências saindo deste local
  transfersTo   StockTransfer[] @relation("TransferTo")   // Transferências chegando neste local
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([companyId, code]) // Código único por empresa
  @@index([companyId])
  @@index([active])
  @@map("stock_locations")
}

// Estoque de Produto por Local
model ProductStockByLocation {
  id         String   @id @default(uuid())
  companyId  String
  company    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  productId  String
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  locationId String
  location   StockLocation @relation(fields: [locationId], references: [id], onDelete: Cascade)
  
  quantity   Decimal  @db.Decimal(10, 3) // Quantidade em estoque neste local
  
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  @@unique([productId, locationId]) // Um produto só pode ter um registro por local
  @@index([companyId])
  @@index([productId])
  @@index([locationId])
  @@map("product_stock_by_location")
}

// Transferência de Estoque entre Locais
model StockTransfer {
  id              String   @id @default(uuid())
  companyId       String
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  code            String   // Código da transferência (ex: "TRANS-001")
  fromLocationId  String
  fromLocation    StockLocation @relation("TransferFrom", fields: [fromLocationId], references: [id], onDelete: Restrict)
  toLocationId    String
  toLocation      StockLocation @relation("TransferTo", fields: [toLocationId], references: [id], onDelete: Restrict)
  
  status          String   // PENDING, IN_TRANSIT, COMPLETED, CANCELLED
  
  notes           String?  // Observações sobre a transferência
  requestedBy     String?  // Usuário que solicitou
  approvedBy      String?  // Usuário que aprovou
  completedBy     String?  // Usuário que completou
  
  requestedAt     DateTime @default(now())
  approvedAt      DateTime?
  completedAt     DateTime?
  
  // Itens da transferência
  items           StockTransferItem[]
  
  // Movimentações relacionadas
  stockMovements  ProductStockMovement[]
  
  // Documento vinculado (guia de transferência, etc)
  documentId      String?
  document        Document? @relation(fields: [documentId], references: [id], onDelete: SetNull)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@unique([companyId, code]) // Código único por empresa
  @@index([companyId])
  @@index([status])
  @@index([fromLocationId])
  @@index([toLocationId])
  @@map("stock_transfers")
}

// Item da Transferência
model StockTransferItem {
  id          String   @id @default(uuid())
  transferId  String
  transfer    StockTransfer @relation(fields: [transferId], references: [id], onDelete: Cascade)
  productId   String
  product     Product  @relation(fields: [productId], references: [id], onDelete: Restrict)
  
  quantity    Decimal  @db.Decimal(10, 3) // Quantidade a transferir
  notes       String?  // Observações sobre este item
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([transferId])
  @@index([productId])
  @@map("stock_transfer_items")
}

// ==================== CLIENTES ====================

// Modelo de Cliente
model Customer {
  id          String   @id @default(uuid())
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  // Tipo de pessoa
  personType  String   // FISICA (CPF) ou JURIDICA (CNPJ)
  
  // ==================== PESSOA FÍSICA ====================
  // Dados básicos
  name        String?  // Nome completo
  cpf         String?  // CPF (somente números)
  rg          String?  // RG
  rgIssuer    String?  // Órgão emissor do RG (ex: SSP)
  rgState     String?  // UF do órgão emissor
  birthDate   DateTime? // Data de nascimento
  gender      String?  // MALE (Masculino), FEMALE (Feminino), OTHER (Outro)
  maritalStatus String? // SINGLE (Solteiro), MARRIED (Casado), DIVORCED (Divorciado), WIDOWED (Viúvo), OTHER (Outro)
  motherName  String?  // Nome da mãe
  profession  String?  // Profissão
  nationality String?  // Nacionalidade (ex: Brasileiro, Estrangeiro)
  
  // ==================== PESSOA JURÍDICA ====================
  // Dados básicos
  companyName String?  // Razão Social
  tradeName   String?  // Nome Fantasia
  cnpj        String?  // CNPJ (somente números)
  stateRegistration String? // Inscrição Estadual
  stateRegistrationExempt Boolean @default(false) // Isento de IE
  municipalRegistration String? // Inscrição Municipal
  cnae        String?  // CNAE principal
  taxRegime   String?  // SIMPLES_NACIONAL, LUCRO_PRESUMIDO, LUCRO_REAL, MEI
  
  // Dados do responsável (para PJ)
  responsibleName  String? // Nome do responsável/representante legal
  responsibleCpf   String? // CPF do responsável
  responsibleEmail String? // Email do responsável
  responsiblePhone String? // Telefone do responsável
  
  // ==================== INFORMAÇÕES GERAIS ====================
  email       String?  // Email principal
  phone       String?  // Telefone principal
  mobile      String?  // Celular/WhatsApp
  website     String?  // Site da empresa
  
  // Limite de crédito e condições comerciais
  creditLimit Decimal? @db.Decimal(10, 2) // Limite de crédito
  
  // Status e observações
  active      Boolean  @default(true)
  notes       String?  @db.Text // Observações gerais
  
  // Auditoria
  createdById String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relacionamentos
  addresses   CustomerAddress[]
  contacts    CustomerContact[]
  
  @@unique([companyId, cpf])
  @@unique([companyId, cnpj])
  @@index([companyId])
  @@index([personType])
  @@index([active])
  @@index([cpf])
  @@index([cnpj])
  @@index([email])
  @@index([name])
  @@index([companyName])
  @@map("customers")
}

// Endereços do Cliente
model CustomerAddress {
  id          String   @id @default(uuid())
  customerId  String
  customer    Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  
  // Tipo de endereço
  type        String   // BILLING (cobrança), SHIPPING (entrega), MAIN (principal), OTHER (outro)
  label       String?  // Label personalizado (ex: "Filial SP", "Escritório Centro")
  
  // Endereço completo
  zipCode     String   // CEP
  street      String   // Logradouro
  number      String   // Número
  complement  String?  // Complemento
  neighborhood String  // Bairro
  city        String   // Cidade
  state       String   // UF (2 letras)
  country     String   @default("Brasil")
  
  // Referência
  reference   String?  // Ponto de referência
  
  // Status
  isDefault   Boolean  @default(false) // Endereço padrão
  active      Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([customerId])
  @@index([type])
  @@index([zipCode])
  @@map("customer_addresses")
}

// Contatos do Cliente
model CustomerContact {
  id          String   @id @default(uuid())
  customerId  String
  customer    Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  
  // Tipo de contato
  type        String   // MAIN (principal), FINANCIAL (financeiro), COMMERCIAL (comercial), OTHER (outro)
  
  // Dados do contato
  name        String   // Nome do contato
  position    String?  // Cargo/Função
  department  String?  // Departamento
  
  // Comunicação
  email       String?  // Email
  phone       String?  // Telefone fixo
  mobile      String?  // Celular/WhatsApp
  
  // Observações
  notes       String?  @db.Text
  
  // Status
  isPrimary   Boolean  @default(false) // Contato principal deste tipo
  active      Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([customerId])
  @@index([type])
  @@index([email])
  @@map("customer_contacts")
}

// ==================== MÓDULO DE RH ====================

// Cargos
model Position {
  id          String   @id @default(uuid())
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  code        String   // Código do cargo (ex: "DEV-SR", "AN-JR")
  name        String   // Nome do cargo (ex: "Desenvolvedor Sênior")
  description String?  @db.Text
  
  // Faixa salarial
  minSalary   Decimal? @db.Decimal(15, 2)
  maxSalary   Decimal? @db.Decimal(15, 2)
  
  // CBO (Classificação Brasileira de Ocupações)
  cbo         String?  // Código CBO
  
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relacionamentos
  employees   Employee[]
  
  @@unique([companyId, code])
  @@index([companyId])
  @@index([active])
  @@map("positions")
}

// Departamentos
model Department {
  id          String   @id @default(uuid())
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  code        String   // Código do departamento (ex: "TI", "FIN", "RH")
  name        String   // Nome do departamento (ex: "Tecnologia da Informação")
  description String?  @db.Text
  
  // Departamento pai (hierarquia)
  parentId    String?
  parent      Department?  @relation("DepartmentHierarchy", fields: [parentId], references: [id])
  children    Department[] @relation("DepartmentHierarchy")
  
  // Gestor do departamento
  managerId   String?
  
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relacionamentos
  employees   Employee[]
  
  @@unique([companyId, code])
  @@index([companyId])
  @@index([parentId])
  @@index([active])
  @@map("departments")
}

// Colaboradores (Funcionários)
model Employee {
  id          String   @id @default(uuid())
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  // Centro de Custo
  costCenterId String?
  costCenter   CentroCusto? @relation(fields: [costCenterId], references: [id])
  
  // Cargo e Departamento
  positionId   String?
  position     Position? @relation(fields: [positionId], references: [id])
  departmentId String?
  department   Department? @relation(fields: [departmentId], references: [id])
  
  // Dados Pessoais
  name        String   // Nome completo
  cpf         String   // CPF
  rg          String?  // RG
  birthDate   DateTime? // Data de nascimento
  gender      String?  // MALE, FEMALE, OTHER
  maritalStatus String? // SINGLE, MARRIED, DIVORCED, WIDOWED, OTHER
  
  // Dados de Contato
  email       String?
  phone       String?
  mobile      String?
  
  // Endereço
  zipCode     String?
  street      String?
  number      String?
  complement  String?
  neighborhood String?
  city        String?
  state       String?
  
  // Dados Profissionais
  admissionDate DateTime // Data de admissão
  dismissalDate DateTime? // Data de demissão
  
  // Dados Contratuais
  contractType String  // CLT, PJ, ESTAGIO, TEMPORARIO, AUTONOMO
  workSchedule Json?   // Horário de trabalho estruturado por dia da semana
  salary      Decimal  @db.Decimal(15, 2) // Salário base
  
  // Dados de Empresa (para PJ)
  companyDocument String? // CNPJ da empresa PJ
  companyName     String? // Razão Social
  companyTradeName String? // Nome Fantasia
  companyStateRegistration String? // Inscrição Estadual
  companyMunicipalRegistration String? // Inscrição Municipal
  companyEmail    String? // Email da empresa
  companyPhone    String? // Telefone da empresa
  companyZipCode  String? // CEP da empresa
  companyStreet   String? // Rua da empresa
  companyNumber   String? // Número da empresa
  companyComplement String? // Complemento da empresa
  companyNeighborhood String? // Bairro da empresa
  companyCity     String? // Cidade da empresa
  companyState    String? // Estado da empresa
  
  // Dados Bancários
  bankCode    String?  // Código do banco
  bankName    String?  // Nome do banco
  agency      String?  // Agência
  account     String?  // Conta
  accountType String?  // CORRENTE, POUPANCA
  pixKey      String?  // Chave PIX
  
  // Status
  active      Boolean  @default(true)
  notes       String?  @db.Text
  
  // Auditoria
  createdById String
  createdBy   User     @relation("EmployeeCreatedBy", fields: [createdById], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relacionamentos
  earnings    EmployeeEarning[] // Proventos do colaborador
  deductions  EmployeeDeduction[] // Descontos do colaborador
  payrollItems PayrollItem[]    // Itens de folha de pagamento
  documents   EmployeeDocument[] // Documentos do colaborador
  
  @@unique([companyId, cpf])
  @@index([companyId])
  @@index([costCenterId])
  @@index([positionId])
  @@index([departmentId])
  @@index([active])
  @@index([cpf])
  @@map("employees")
}

// Centro de Custos


// Tipos de Proventos (ex: Salário, Hora Extra, Adicional Noturno, etc)
model EarningType {
  id          String   @id @default(uuid())
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  code        String   // Código do provento
  name        String   // Nome do provento
  description String?  @db.Text
  
  // Configurações
  isRecurrent Boolean  @default(false) // Se é recorrente (aparece todo mês)
  isPercentage Boolean @default(false) // Se é percentual sobre o salário
  baseValue   Decimal? @db.Decimal(15, 2) // Valor base (se não for percentual)
  
  // Incidências
  hasINSS     Boolean  @default(true)  // Incide INSS
  hasFGTS     Boolean  @default(true)  // Incide FGTS
  hasIRRF     Boolean  @default(true)  // Incide IRRF
  
  // Status
  active      Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relacionamentos
  employeeEarnings EmployeeEarning[] // Proventos dos colaboradores
  
  @@unique([companyId, code])
  @@index([companyId])
  @@map("earning_types")
}

// Tipos de Descontos (ex: INSS, IRRF, Vale Transporte, etc)
model DeductionType {
  id          String   @id @default(uuid())
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  code        String   // Código do desconto
  name        String   // Nome do desconto
  description String?  @db.Text
  
  // Configurações
  isRecurrent Boolean  @default(false) // Se é recorrente (todo mês)
  isPercentage Boolean @default(false) // Se é percentual
  baseValue   Decimal? @db.Decimal(15, 2) // Valor fixo
  
  // Status
  active      Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relacionamentos
  employeeDeductions EmployeeDeduction[] // Descontos dos colaboradores
  
  @@unique([companyId, code])
  @@index([companyId])
  @@map("deduction_types")
}

// Proventos atribuídos aos colaboradores
model EmployeeEarning {
  id            String   @id @default(uuid())
  employeeId    String
  employee      Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  
  earningTypeId String
  earningType   EarningType @relation(fields: [earningTypeId], references: [id])
  
  // Configuração específica do colaborador
  isRecurrent   Boolean  @default(false) // Se repete todo mês
  value         Decimal? @db.Decimal(15, 2) // Valor (se diferente do padrão)
  percentage    Decimal? @db.Decimal(5, 2)  // Percentual (se aplicável)
  
  // Período de validade
  startDate     DateTime // Data de início
  endDate       DateTime? // Data de fim (null = indeterminado)
  
  // Status
  active        Boolean  @default(true)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([employeeId])
  @@index([earningTypeId])
  @@map("employee_earnings")
}

// Descontos atribuídos aos colaboradores
model EmployeeDeduction {
  id              String   @id @default(uuid())
  employeeId      String
  employee        Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  
  deductionTypeId String
  deductionType   DeductionType @relation(fields: [deductionTypeId], references: [id])
  
  // Configuração específica do colaborador
  isRecurrent     Boolean  @default(false) // Se repete todo mês
  value           Decimal? @db.Decimal(15, 2) // Valor (se diferente do padrão)
  percentage      Decimal? @db.Decimal(5, 2)  // Percentual (se aplicável)
  
  // Período de validade
  startDate       DateTime // Data de início
  endDate         DateTime? // Data de fim (null = indeterminado)
  
  // Status
  active          Boolean  @default(true)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([employeeId])
  @@index([deductionTypeId])
  @@map("employee_deductions")
}

// Folha de Pagamento (mensal ou diária)
model Payroll {
  id          String   @id @default(uuid())
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  // Período
  referenceMonth Int    // Mês de referência (1-12)
  referenceYear  Int    // Ano de referência
  type        String   // MONTHLY (mensal), DAILY (diária), WEEKLY (semanal), ADVANCE (adiantamento)
  
  // Datas
  startDate   DateTime // Data de início do período
  endDate     DateTime // Data de fim do período
  paymentDate DateTime // Data de pagamento
  
  // Status
  status      String   @default("DRAFT") // DRAFT (rascunho), CALCULATED (calculada), APPROVED (aprovada), PAID (paga)
  
  // Totais
  totalEarnings   Decimal @default(0) @db.Decimal(15, 2) // Total de proventos
  totalDeductions Decimal @default(0) @db.Decimal(15, 2) // Total de descontos
  netAmount       Decimal @default(0) @db.Decimal(15, 2) // Líquido a pagar
  
  // Auditoria
  createdById String
  createdBy   User     @relation("PayrollCreatedBy", fields: [createdById], references: [id])
  approvedById String?
  approvedBy  User?    @relation("PayrollApprovedBy", fields: [approvedById], references: [id])
  approvedAt  DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relacionamentos
  items       PayrollItem[] // Itens da folha (por colaborador)
  
  @@unique([companyId, referenceMonth, referenceYear, type])
  @@index([companyId])
  @@index([status])
  @@map("payrolls")
}

// Itens da Folha de Pagamento (por colaborador)
model PayrollItem {
  id          String   @id @default(uuid())
  payrollId   String
  payroll     Payroll  @relation(fields: [payrollId], references: [id], onDelete: Cascade)
  
  employeeId  String
  employee    Employee @relation(fields: [employeeId], references: [id])
  
  // Valores Base
  baseSalary  Decimal  @db.Decimal(15, 2) // Salário base
  workDays    Int      @default(30) // Dias trabalhados
  
  // Proventos
  earnings    Json     // Array de proventos: [{ typeId, code, name, value }]
  totalEarnings Decimal @db.Decimal(15, 2) // Total de proventos
  
  // Descontos
  deductions  Json     // Array de descontos: [{ typeId, code, name, value }]
  totalDeductions Decimal @db.Decimal(15, 2) // Total de descontos
  
  // Líquido
  netAmount   Decimal  @db.Decimal(15, 2) // Líquido a pagar
  
  // Observações
  notes       String?  @db.Text
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([payrollId])
  @@index([employeeId])
  @@map("payroll_items")
}

// Documentos de Colaboradores
model EmployeeDocument {
  id          String   @id @default(uuid())
  employeeId  String
  employee    Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  
  // Tipo de documento
  documentType String  // RG, CPF, CNH, CTPS, TITULO_ELEITOR, CERTIFICADO_RESERVISTA, 
                       // COMPROVANTE_RESIDENCIA, DIPLOMA, CERTIFICADO, CONTRATO, 
                       // EXAME_ADMISSIONAL, ASO, ATESTADO, OUTROS
  
  // Informações do documento
  name        String   // Nome do arquivo/documento
  description String?  @db.Text
  documentNumber String? // Número do documento (se aplicável)
  issueDate   DateTime? // Data de emissão
  expiryDate  DateTime? // Data de validade
  
  // Arquivo
  fileUrl     String   // URL do arquivo no storage
  fileName    String   // Nome original do arquivo
  fileSize    Int      // Tamanho em bytes
  mimeType    String   // Tipo MIME do arquivo
  
  // Status
  verified    Boolean  @default(false) // Se foi verificado/validado
  active      Boolean  @default(true)
  notes       String?  @db.Text
  
  // Auditoria
  uploadedById String
  uploadedBy   User     @relation("DocumentUploadedByUser", fields: [uploadedById], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@index([employeeId])
  @@index([documentType])
  @@index([verified])
  @@map("employee_documents")
}

// Tabela INSS - Faixas progressivas de contribuição
model InssTable {
  id        String   @id @default(uuid())
  companyId String
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  year      Int      // Ano de referência
  month     Int      // Mês de referência
  
  // Faixas progressivas (JSON)
  // [{ minValue, maxValue, employeeRate, employerRate, deduction }]
  ranges    Json
  
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([companyId, year, month, active])
  @@index([companyId])
  @@index([year, month])
  @@map("inss_tables")
}

// Tabela FGTS - Alíquotas por categoria
model FgtsTable {
  id        String   @id @default(uuid())
  companyId String
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  year      Int      // Ano de referência
  month     Int      // Mês de referência
  
  // Alíquotas por categoria (JSON)
  // [{ category, monthlyRate, terminationRate, description }]
  rates     Json
  
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([companyId, year, month, active])
  @@index([companyId])
  @@index([year, month])
  @@map("fgts_tables")
}

// Tabela IRRF - Faixas de imposto de renda
model IrrfTable {
  id                 String   @id @default(uuid())
  companyId          String
  company            Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  year               Int      // Ano de referência
  month              Int      // Mês de referência
  
  dependentDeduction Decimal  @db.Decimal(10, 2) // Dedução por dependente
  
  // Faixas progressivas (JSON)
  // [{ minValue, maxValue, rate, deduction }]
  ranges             Json
  
  active             Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  
  @@unique([companyId, year, month, active])
  @@index([companyId])
  @@index([year, month])
  @@map("irrf_tables")
}
