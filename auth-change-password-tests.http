### ========================================
### üîê Teste de Altera√ß√£o de Senha
### ========================================

@baseUrl = http://localhost:4000
@email = user@example.com
@oldPassword = senha123

### 1. Login (obter token)
# @name login
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{email}}",
  "password": "{{oldPassword}}"
}

### Extrair token da resposta
@token = {{login.response.body.access_token}}

### ========================================

### 2. Alterar senha
PATCH {{baseUrl}}/auth/change-password
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "oldPassword": "senha123",
  "newPassword": "novaSenhaSegura456"
}

### ========================================

### 3. Testar login com senha antiga (deve falhar - 401)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{email}}",
  "password": "senha123"
}

### ========================================

### 4. Login com nova senha (deve funcionar)
# @name loginNew
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{email}}",
  "password": "novaSenhaSegura456"
}

### Extrair novo token
@newToken = {{loginNew.response.body.access_token}}

### ========================================

### 5. Restaurar senha original
PATCH {{baseUrl}}/auth/change-password
Authorization: Bearer {{newToken}}
Content-Type: application/json

{
  "oldPassword": "novaSenhaSegura456",
  "newPassword": "senha123"
}

### ========================================
### ‚ùå TESTES DE ERRO
### ========================================

### 6. Erro: Sem token (401 Unauthorized)
PATCH {{baseUrl}}/auth/change-password
Content-Type: application/json

{
  "oldPassword": "senha123",
  "newPassword": "novaSenha456"
}

### ========================================

### 7. Erro: Senha antiga incorreta (403)
PATCH {{baseUrl}}/auth/change-password
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "oldPassword": "senhaErrada",
  "newPassword": "novaSenha456"
}

### ========================================

### 8. Erro: Nova senha muito curta (400)
PATCH {{baseUrl}}/auth/change-password
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "oldPassword": "senha123",
  "newPassword": "123"
}

### ========================================

### 9. Erro: Nova senha igual √† antiga (400)
PATCH {{baseUrl}}/auth/change-password
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "oldPassword": "senha123",
  "newPassword": "senha123"
}

### ========================================

### 10. Erro: Campos ausentes (400)
PATCH {{baseUrl}}/auth/change-password
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "oldPassword": "senha123"
}

### ========================================

### 11. Verificar perfil (confirma token v√°lido)
GET {{baseUrl}}/auth/profile
Authorization: Bearer {{token}}
