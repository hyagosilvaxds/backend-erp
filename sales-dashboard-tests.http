### ========================================
### üìä Dashboard - Estat√≠sticas de Vendas
### ========================================

@baseUrl = http://localhost:4000
@adminEmail = admin@example.com
@adminPassword = senha123

### 1. Login como Admin
# @name login
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}"
}

### Extrair token e companyId
@token = {{login.response.body.access_token}}
@companyId = {{login.response.body.user.companies[0].companyId}}

### ========================================

### 2. Obter Estat√≠sticas do Dashboard
GET {{baseUrl}}/sales/dashboard/stats
Authorization: Bearer {{token}}
x-company-id: {{companyId}}

### ========================================
### üìù An√°lise da Resposta
### ========================================

### Resposta esperada inclui:
### 
### 1. period - Per√≠odo de an√°lise
###    - currentMonth (in√≠cio e fim)
###    - previousMonth (in√≠cio e fim)
###
### 2. metrics - M√©tricas comparativas
###    - sales (vendas totais + varia√ß√£o %)
###    - products (produtos ativos + varia√ß√£o %)
###    - customers (clientes + varia√ß√£o %)
###    - averageTicket (ticket m√©dio + varia√ß√£o %)
###
### 3. recentSales - Array com 4 vendas mais recentes
###    - code, customer, totalAmount, paymentMethod
###    - confirmedAt, status
###
### 4. topProducts - Array com 4 produtos mais vendidos
###    - product (id, name, sku, salePrice, currentStock)
###    - quantitySold (total de unidades vendidas)
###    - salesCount (n√∫mero de vendas)

### ========================================
### üß™ Testes de Valida√ß√£o
### ========================================

### 3. Teste sem token (deve retornar 401)
GET {{baseUrl}}/sales/dashboard/stats
x-company-id: {{companyId}}

### ========================================

### 4. Teste sem company-id (deve retornar erro)
GET {{baseUrl}}/sales/dashboard/stats
Authorization: Bearer {{token}}

### ========================================

### 5. Teste com company-id inv√°lido
GET {{baseUrl}}/sales/dashboard/stats
Authorization: Bearer {{token}}
x-company-id: invalid-uuid

### ========================================
### üìà Exemplos de Uso
### ========================================

### Exemplo 1: Verificar vendas do m√™s
### Comando: jq '.metrics.sales'
### Resultado esperado:
### {
###   "current": 125000.50,
###   "previous": 98000.00,
###   "change": 27.55,
###   "changePercent": "+27.55%"
### }

### Exemplo 2: Listar vendas recentes
### Comando: jq '.recentSales[].code'
### Resultado: ["VEN-2025-0042", "VEN-2025-0041", ...]

### Exemplo 3: Ver produtos mais vendidos
### Comando: jq '.topProducts[].product.name'
### Resultado: ["Notebook Dell", "Mouse Logitech", ...]

### ========================================
### üí° Dicas de Teste
### ========================================

### Para testar com dados reais:
### 1. Criar algumas vendas
### 2. Confirmar as vendas
### 3. Chamar o endpoint de stats
### 4. Verificar se os n√∫meros batem

### Para testar varia√ß√£o mensal:
### 1. Criar vendas em meses diferentes
### 2. Usar script SQL para alterar confirmedAt
### 3. Verificar se c√°lculo de % est√° correto
